<html>
<body>
<script language="JavaScript">
var canvas = document.createElement('canvas');
canvas.style.position = 'fixed';
canvas.style.top = '0px';
canvas.style.left = '0px';
canvas.style.zIndex = '-10';
var B=15,A=12;
canvas.width =B*51; //document.body.offsetWidth;
canvas.height =A*51;// window.innerHeight;
document.body.insertBefore(canvas, document.body.firstChild);
var N=2//kol pictures
var p=canvas.getContext('2d');
var img=new Array();
for(var i=0;i<6;i++)img[i]=new Image();
img[0].src="1.bmp";//pol
img[1].src="2.bmp";//kubic blue
img[2].src="3.png";//stena
img[3].src="4.bmp";//personag
img[4].src="5.bmp";//X
img[5].src="2_a.bmp";//kubik red
var q=new Array(A),key;
for(var i=0;i<A;i++)q[i]=new Array(B);
var m_kol,mi=new Array(),mj=new Array();

function hod(){
var i,j;
	for( var k=0;k<A;k++)
		for(var l=0;l<B;l++)
			if(q[k][l]==3){
			i=k;
			j=l;
			}
	if(key==1){
		if(q[i][j-1]==0){//pol
			q[i][j-1]=3;
			q[i][j]=0;
		}
		if(q[i][j-1]==1||q[i][j-1]==5){//blue
			if(q[i][j-2]==0){
				q[i][j-2]=1;
				q[i][j-1]=3;
				q[i][j]=0;
			}
			if(q[i][j-2]==4){
				q[i][j-2]=5;
				q[i][j-1]=3;
				q[i][j]=0;
			}
		}
		if(q[i][j-1]==4){//X
			q[i][j-1]=3;
			q[i][j]=0;
		}
	}
	if(key==2){
		if(q[i-1][j]==0){//pol
			q[i-1][j]=3;
			q[i][j]=0;
		}
		if(q[i-1][j]==1||q[i-1][j]==5){//blue
			if(q[i-2][j]==0){
				q[i-2][j]=1;
				q[i-1][j]=3;
				q[i][j]=0;
			}
			if(q[i-2][j]==4){
				q[i-2][j]=5;
				q[i-1][j]=3;
				q[i][j]=0;
			}
		}
		if(q[i-1][j]==4){//X
			q[i-1][j]=3;
			q[i][j]=0;
		}
	}
	if(key==3){
		if(q[i][j+1]==0){//pol
			q[i][j+1]=3;
			q[i][j]=0;
		}
		if(q[i][j+1]==1||q[i][j+1]==5){//blue
			if(q[i][j+2]==0){
				q[i][j+2]=1;
				q[i][j+1]=3;
				q[i][j]=0;
			}
			if(q[i][j+2]==4){
				q[i][j+2]=5;
				q[i][j+1]=3;
				q[i][j]=0;
			}
		}
		if(q[i][j+1]==4){//X
			q[i][j+1]=3;
			q[i][j]=0;
		}
	}
	if(key==4){
		if(q[i+1][j]==0){//pol
			q[i+1][j]=3;
			q[i][j]=0;
		}
		if(q[i+1][j]==1||q[i+1][j]==5){//blue
			if(q[i+2][j]==0){
				q[i+2][j]=1;
				q[i+1][j]=3;
				q[i][j]=0;
			}
			if(q[i+2][j]==4){
				q[i+2][j]=5;
				q[i+1][j]=3;
				q[i][j]=0;
			}
		}
		if(q[i+1][j]==4){//X
			q[i+1][j]=3;
			q[i][j]=0;
		}
	}
var no_x=0;	
	for(var k=0;k<m_kol;k++){
		if(q[mi[k]][mj[k]]==0)q[mi[k]][mj[k]]=4;
		if(q[mi[k]][mj[k]]==5)no_x++;
		}
		if(no_x==m_kol)var ID=setTimeout('win()',10);
	paint();return;
}

function win(){
alert("Ты выиграл!");
return;
}

function paint(){	
	for(var i=0;i<A;i++){
		for(var j=0;j<B;j++)
			if(q[i][j]==2)p.drawImage(img[q[i][j]],j*48-10,i*48-10);
			else p.drawImage(img[q[i][j]],j*48,i*48);
	}

	return;
}
function presskey(evt){	         
		evt = (evt) ? evt : window.event;
       if(evt){		   
			var code = (evt.charCode)?evt.charCode : evt.keyCode;
			if(code==37||code==97){key=1;hod();}
			if(code==38||code==119){key=2;hod();}
			if(code==39||code==100){key=3;hod();}
			if(code==40||code==115){key=4;hod();}
       }
return;
}
function iniz(){
	m_kol=0;
	for(var k=0;k<A;k++)
		for(var l=0;l<B;l++)
			if(q[k][l]==4){
				mi[m_kol]=k;
				mj[m_kol]=l;
				m_kol++;
			}
	paint();
	return;
}
function level1(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,0,4,0,2,2,2,2,2,2,2,2,2],
		[2,2,0,0,1,0,0,2,2,2,2,2,2,2,2],
		[2,2,4,1,3,1,4,2,2,2,2,2,2,2,2],
		[2,2,0,0,1,0,0,2,2,2,2,2,2,2,2],
		[2,2,2,0,4,0,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
function level2(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,0,0,0,0,2,0,4,4,4,4,2,2,2,2],
		[2,0,1,1,1,0,0,4,4,4,4,2,2,2,2],
		[2,0,1,0,0,2,0,0,4,4,4,2,2,2,2],
		[2,0,0,0,0,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,0,2,2,0,0,0,2,2,2,2,2,2],
		[2,0,0,0,0,2,0,3,0,2,2,2,2,2,2],
		[2,0,1,1,0,0,1,1,0,2,2,2,2,2,2],
		[2,0,1,0,1,2,0,0,0,2,2,2,2,2,2],
		[2,2,1,0,0,2,2,2,2,2,2,2,2,2,2],
		[2,2,0,0,0,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
function level3(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,0,0,0,2],
		[2,2,2,2,2,2,2,2,2,2,0,1,0,0,2],
		[2,2,2,2,2,2,2,2,3,1,0,0,0,0,2],
		[2,2,2,2,2,2,2,2,1,2,2,2,1,2,2],
		[2,2,2,2,2,2,2,0,0,2,2,2,0,0,2],
		[2,2,2,2,2,2,0,1,0,2,2,0,0,4,2],
		[2,2,2,2,2,2,0,0,0,1,0,0,4,4,2],
		[2,2,2,2,2,2,0,0,0,2,0,4,4,4,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
function level4(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,0,0,0,0,0,2,2,2,2,2,2,2],
		[2,2,2,0,1,0,1,0,2,2,2,2,2,2,2],
		[2,2,2,0,2,2,2,1,0,0,2,4,4,4,2],
		[2,2,2,0,2,2,2,0,2,1,2,0,0,4,2],
		[2,2,2,3,1,0,0,0,0,0,0,0,0,4,2],
		[2,2,2,0,2,2,2,0,2,1,2,0,0,4,2],
		[2,2,2,0,2,2,2,1,0,0,2,4,4,4,2],
		[2,2,2,0,1,0,1,0,2,2,2,2,2,2,2],
		[2,2,2,0,0,0,0,0,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
function level5(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,4,0,4,0,4,2,2,2,2,2,2,2,2],
		[2,2,0,1,1,1,0,2,2,2,2,2,2,2,2],
		[2,2,4,1,3,1,4,2,2,2,2,2,2,2,2],
		[2,2,0,1,1,1,0,2,2,2,2,2,2,2,2],
		[2,2,4,0,4,0,4,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
function level6(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,0,4,4,2,4,4,3,2,2,2,2,2],
		[2,2,2,0,1,0,2,0,1,0,2,2,2,2,2],
		[2,2,2,0,1,0,0,0,1,0,2,2,2,2,2],
		[2,2,2,2,2,0,2,0,2,2,2,2,2,2,2],
		[2,2,2,0,1,0,0,0,1,0,2,2,2,2,2],
		[2,2,2,0,1,0,2,0,1,0,2,2,2,2,2],
		[2,2,2,0,4,4,2,4,4,0,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
function level7(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,0,0,0,2,2,2,2,2,2,2],
		[2,2,0,0,1,0,0,0,0,0,2,2,2,2,2],
		[2,2,3,1,2,1,2,0,1,0,2,2,2,2,2],
		[2,0,0,0,2,4,4,2,2,1,2,2,2,2,2],
		[2,0,0,2,4,4,4,4,1,0,0,2,2,2,2],
		[2,0,0,1,4,4,4,4,2,0,0,2,2,2,2],
		[2,2,1,2,2,4,4,2,0,0,0,2,2,2,2],
		[2,2,0,1,0,2,1,2,1,0,2,2,2,2,2],
		[2,2,0,0,0,0,0,1,0,0,2,2,2,2,2],
		[2,2,2,2,0,0,0,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
function level8(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,0,0,2,2,2,2,2,2,2],
		[2,2,2,2,0,0,0,1,0,2,2,2,2,2,2],
		[2,2,2,0,1,2,4,2,0,2,2,2,2,2,2],
		[2,2,2,0,0,4,3,4,0,0,2,2,2,2,2],
		[2,2,2,2,0,2,4,2,1,0,2,2,2,2,2],
		[2,2,2,2,0,1,0,0,0,2,2,2,2,2,2],
		[2,2,2,2,2,0,0,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
function level9(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,0,0,0,0,0,0,0,2,2,2,2,2],
		[2,2,2,0,4,1,4,1,4,0,2,2,2,2,2],
		[2,2,2,0,1,4,1,4,1,0,2,2,2,2,2],
		[2,2,2,0,4,1,3,1,4,0,2,2,2,2,2],
		[2,2,2,0,1,4,1,4,1,0,2,2,2,2,2],
		[2,2,2,0,4,1,4,1,4,0,2,2,2,2,2],
		[2,2,2,0,0,0,0,0,0,0,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
function level10(){//0=pol;1=kubic;2=stena;3=personage;4=mesto kubika
	q=[//
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,4,4,4,4,2,2,2,2,2,2,2,2,2,2],
		[2,4,4,4,1,2,2,2,2,2,2,2,2,2,2],
		[2,4,4,4,0,0,1,0,0,2,2,2,2,2,2],
		[2,4,1,0,0,2,0,1,0,2,2,2,2,2,2],
		[2,2,2,0,2,2,0,1,0,2,2,2,2,2,2],
		[2,2,2,1,0,0,1,1,0,2,2,2,2,2,2],
		[2,2,2,0,1,1,1,3,0,2,2,2,2,2,2],
		[2,2,2,0,0,0,0,0,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
		[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
	];
	iniz();
	return;
}
level1();
document.onkeypress = presskey; 
</script>
<form>
<p align="right">Уровень:<br><input type="button" value="1"onclick="level1()"><br>
<input type="button" value="2"onclick="level2()"><br>
<input type="button" value="3"onclick="level3()"><br>
<input type="button" value="4"onclick="level4()"><br>
<input type="button" value="5"onclick="level5()"><br>
<input type="button" value="6"onclick="level6()"><br>
<input type="button" value="7"onclick="level7()"><br>
<input type="button" value="8"onclick="level8()"><br>
<input type="button" value="9"onclick="level9()"><br>
<input type="button" value="10"onclick="level10()"><br>
</form>
</body>
</html>